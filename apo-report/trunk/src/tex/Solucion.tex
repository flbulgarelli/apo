\section{Solución propuesta}
\label{sec:Solucion}

	Utilizamos la programación orientada a aspectos para desarrollar dos
	conceptos independientes, {\bf Observable} y  {\bf Transaccional}.
	En las secciones subsiguientes se describe el comportamiento de cada uno de
	estos dos aspectos y en la sección \ref{sec:Union} la integración de ambos.

	\subsection{Aspecto Observable}
	\label{aspectoObservable}
		El aspecto Observable implementa un mecanismo transparente para que cuando un
		objeto de dominio cambia, cualquier parte del sistema pueda recibir una
		notificación informando ese cambio.
		Para ello, el sistema asocia cada atributo de un objeto que se desee observar
		con un conjunto de \emph{listeners}. 
		El aspecto intercepta todos los accesos a los atributos
		del objeto observado y, ante cada modificación de un atributo, notifica a todos
		los listeners que se han registrado para observar ese atributo.
		
		Este mecanismo permite asociar acciones específicas que se disparan cada vez
		que el objeto es modificado. En particular, se utiliza para mantener
		sincronizada la UI con los objetos del dominio.

	\subsection{Aspecto Transaccional}
	\label{aspectoTransaccional}
		El aspecto Transaccional permite controlar la visibilidad de las modificaciones
		realizadas a un objeto.
		Para ello, se define el concepto de \emph{contexto transaccional}.
		Un contexto trasaccional es un espacio de trabajo en el cual se pueden
		hacer modificaciones a un objeto que no serán vistas fuera de ese contexto.
	
		Los contextos transaccionales se delimitan por las
		operaciones detalladas en la Sección \ref{ctxTransactional}
		(\emph{beginTransaction}, \emph{commit} y \emph{rollback}).
		La operación de \emph{commit} confirma las modificaciones y las hace públicas
		fuera del contexto.
		Por su parte, la operación de \emph{rollback} provee un
		mecanismo automático para descartar todas las modificaciones realizadas
		dentro del contexto.
		Al ejecutarla, todos los objetos modificados dentro del contexto regresan al
		estado que tenían al comenzar la transacción.
		 
		El contexto transaccional permite el trabajo concurrente, permitiendo que
		varios procesos puedan acceder a un mismo objeto al mismo
		tiempo, con un aislamiento de nivel \emph{read commited}.
		 
		También se da soporte para \emph{transacciones anidadas}, es decir, la
		posibilidad de abrir un nuevo contexto transaccional dentro de otro contexto,
		denominado \emph{contexto padre}.
		Esta funcionalidad permite dividir una transacción en partes que pueden ser
		revertidas o confirmadas individualmente.
		
	\subsection{Integración de ambos aspectos entre sí y con la UI}
	\label{sec:Union}
		Al utilizar ambos aspectos simultáneamente aparecen situaciones complejas que
		deben ser tenidas en cuenta. También es necesario estudiar la forma en que
		puedan integrar ambos aspectos con la UI.
		Para atacar estos problemas se tomaron tres acciones:
		
		\begin{enumerate}
		  \item Cuando la UI muestra en pantalla el valor de un
		  atributo de un objeto de dominio, debe registrarse como listener de ese
		  atributo.
		  De esa forma, en caso de producirse un cambio en el valor del atributo, la
		  UI podrá reflejar esa modificación en forma inmediata.
		  
		  \item Siempre que desde la UI el usuario tenga la posibilidad de cancelar
		  una acción que comenzó a realizar, se debe utilizar un contexto
		  transaccional.
		  Esto se logra incluyendo en la UI las operaciones de
		  \emph{beginTransaction}, \emph{commit} y \emph{rollback}.
		  
		  La estrategia utilizada para integrar de un framework
		  específico de UI con el aspecto transaccional es extender el framework
		  elegido con herramientas que manejen los contextos transaccionales en forma
		  automática.
		  
		  \item La integración de los aspectos entre sí se logra asociando a
		  cada listener con un contexto transaccional y limitando el alcance de los
		  eventos producidos por el aspecto observable para que sólo notifiquen a los
		  listeners que se encuentran en la misma transacción que produjo el cambio.
		\end{enumerate}
